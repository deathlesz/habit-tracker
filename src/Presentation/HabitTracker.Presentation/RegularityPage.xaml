<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="HabitTracker.Presentation.RegularityPage"
             Title="RegularityPage">


    <ContentPage.Resources>

        <!-- Rounded pill-like style for list buttons -->
        <Style TargetType="Button" x:Key="ListButton">
            <Setter Property="CornerRadius" Value="18"/>
            <Setter Property="Padding" Value="18,12"/>
            <Setter Property="WidthRequest" Value="300"/>
            <Setter Property="HeightRequest" Value="60"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="TextColor" Value="{StaticResource ButtonText}"/>
            <Setter Property="BackgroundColor" Value="{StaticResource PrimaryBlue}"/>
            <Setter Property="BorderColor" Value="#7A8BB3"/>
            <Setter Property="BorderWidth" Value="1.5"/>
            <Setter Property="Shadow">
                <Setter.Value>
                    <Shadow Brush="#33000000" Opacity="0.4" Radius="8" Offset="0,3"/>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Footer buttons -->
        <Style TargetType="Button" x:Key="FooterSave">
            <Setter Property="TextColor" Value="Black"/>
            <Setter Property="BackgroundColor" Value="{StaticResource SaveGreen}"/>
            <Setter Property="CornerRadius" Value="14"/>
            <Setter Property="Padding" Value="18,10"/>
            <Setter Property="FontAttributes" Value="Bold"/>
        </Style>

        <Style TargetType="Button" x:Key="FooterCancel" BasedOn="{StaticResource FooterSave}">
            <Setter Property="BackgroundColor" Value="{StaticResource DangerRed}"/>
        </Style>

    </ContentPage.Resources>


    <Grid 
        RowDefinitions="Auto,* ,Auto" 
        Padding="0,10,0,0"
        BackgroundColor="{StaticResource PageBg}">

        <!-- Header pill -->
        <Border
            Grid.Row="0"
            BackgroundColor="{StaticResource OrangeHeader}"
            StrokeShape="RoundRectangle 999"
            HorizontalOptions="Center"
            Padding="26,10"
            Margin="0,6,0,10">
            <Label 
                Text="Select Regularity" 
                FontAttributes="Bold" 
                FontSize="32" 
                TextColor="Black"/>
        </Border>

        <!-- Scrollable content -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout
                Spacing="14"
                Padding="16"
                x:Name="Root">

                <!-- Mode selection: Daily / Monthly / Interval -->
                <Border 
                    Stroke="#7A8BB3" 
                    StrokeThickness="1" 
                    StrokeShape="RoundRectangle 12" 
                    Padding="12"
                    BackgroundColor="{StaticResource PrimaryBlue}">
                    <VerticalStackLayout Spacing="8">
                        <Label Text="Mode" FontAttributes="Bold" TextColor="Black"/>
                        <HorizontalStackLayout Spacing="12">
                            <RadioButton Content="Daily"
                                TextColor="Black"
                                GroupName="RegMode"
                                IsChecked="{Binding IsDaily}"/>
                            <RadioButton Content="Monthly"
                                TextColor="Black"
                                GroupName="RegMode"
                                IsChecked="{Binding IsMonthly}"/>
                            <RadioButton Content="Interval"
                                TextColor="Black"
                                GroupName="RegMode"
                                IsChecked="{Binding IsInterval}"/>
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!-- DAILY SECTION -->
                <Border 
                    Stroke="#7A8BB3" 
                    StrokeThickness="1" 
                    StrokeShape="RoundRectangle 12" 
                    Padding="12"
                    BackgroundColor="{StaticResource PrimaryBlue}">
                    <Border.Triggers>
                        <DataTrigger 
                            TargetType="Border" 
                            Binding="{Binding IsDaily}" 
                            Value="False">
                            <Setter 
                                Property="IsVisible" 
                                Value="False"/>
                        </DataTrigger>
                    </Border.Triggers>

                    <VerticalStackLayout Spacing="10">
                        <Label Text="Daily options" FontAttributes="Bold" TextColor="Black"/>

                        <!-- A) Simple “every day” -->
                        <HorizontalStackLayout Spacing="6">
                            <CheckBox IsChecked="{Binding DailyEveryDay}" />
                            <Label Text="Every day" VerticalTextAlignment="Center" TextColor="Black"/>
                        </HorizontalStackLayout>

                        <!-- B) Specific days of the week -->
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Specific days of the week" TextColor="Black"/>
                            <FlexLayout Wrap="Wrap" Direction="Row" JustifyContent="Start" AlignItems="Center">
                                <HorizontalStackLayout Spacing="4">
                                    <CheckBox IsChecked="{Binding Monday}"/>
                                    <Label Text="Mon" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Spacing="4">
                                    <CheckBox IsChecked="{Binding Tuesday}"/>
                                    <Label Text="Tue" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Spacing="4">
                                    <CheckBox IsChecked="{Binding Wednesday}"/>
                                    <Label Text="Wed" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Spacing="4">
                                    <CheckBox IsChecked="{Binding Thursday}"/>
                                    <Label Text="Thu" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Spacing="4">
                                    <CheckBox IsChecked="{Binding Friday}"/>
                                    <Label Text="Fri" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Spacing="4">
                                    <CheckBox IsChecked="{Binding Saturday}"/>
                                    <Label Text="Sat" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Spacing="4">
                                    <CheckBox IsChecked="{Binding Sunday}"/>
                                    <Label Text="Sun" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                            </FlexLayout>
                        </VerticalStackLayout>

                        <!-- C) N-days per week -->
                        <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                            <Label Text="Days per week:" VerticalTextAlignment="Center"  TextColor="Black"/>
                            <Slider 
                                Minimum="1" 
                                Maximum="7"
                                Value="{Binding DailyDaysPerWeek}" WidthRequest="180"/>
                            <Label Text="{Binding DailyDaysPerWeek}" WidthRequest="28" HorizontalTextAlignment="Center" TextColor="Black" />
                        </HorizontalStackLayout>

                        <!-- Daily validation hint -->
                        <Label Text="Select at least one: Every day, specific days, or days per week."
                            TextColor="#B00020"
                            IsVisible="{Binding DailyInvalid}" />
                    </VerticalStackLayout>
                </Border>

                <!-- MONTHLY SECTION -->
                <Border 
                    Stroke="#7A8BB3" 
                    StrokeThickness="1" 
                    StrokeShape="RoundRectangle 12" 
                    Padding="12"
                    BackgroundColor="{StaticResource PrimaryBlue}">
                    <Border.Triggers>
                        <DataTrigger TargetType="Border" Binding="{Binding IsMonthly}" Value="False">
                            <Setter Property="IsVisible" Value="False"/>
                        </DataTrigger>
                    </Border.Triggers>

                    <VerticalStackLayout Spacing="10">
                        <Label Text="Monthly options" FontAttributes="Bold" TextColor="Black"/>

                        <!-- A) Specific days of month -->
                        <VerticalStackLayout>
                            <Label Text="Specific days of the month" TextColor="Black" />
                            <!-- Grid for 1..31 -->
                            <Grid ColumnDefinitions="*,*,*,*,*,*,*"
                                RowDefinitions="Auto,Auto,Auto,Auto,Auto">
                                <HorizontalStackLayout Grid.Row="0" Grid.Column="0">
                                    <CheckBox IsChecked="{Binding MonthlyDays[1]}"/>
                                    <Label Text="1" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="0" Grid.Column="1">
                                    <CheckBox IsChecked="{Binding MonthlyDays[2]}"/>
                                    <Label Text="2" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="0" Grid.Column="2">
                                    <CheckBox IsChecked="{Binding MonthlyDays[3]}"/>
                                    <Label Text="3" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="0" Grid.Column="3">
                                    <CheckBox IsChecked="{Binding MonthlyDays[4]}"/>
                                    <Label Text="4" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="0" Grid.Column="4">
                                    <CheckBox IsChecked="{Binding MonthlyDays[5]}"/>
                                    <Label Text="5" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="0" Grid.Column="5">
                                    <CheckBox IsChecked="{Binding MonthlyDays[6]}"/>
                                    <Label Text="6" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="0" Grid.Column="6">
                                    <CheckBox IsChecked="{Binding MonthlyDays[7]}"/>
                                    <Label Text="7" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="1" Grid.Column="0">
                                    <CheckBox IsChecked="{Binding MonthlyDays[8]}"/>
                                    <Label Text="8" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="1" Grid.Column="1">
                                    <CheckBox IsChecked="{Binding MonthlyDays[9]}"/>
                                    <Label Text="9" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="1" Grid.Column="2">
                                    <CheckBox IsChecked="{Binding MonthlyDays[10]}"/>
                                    <Label Text="10" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="1" Grid.Column="3">
                                    <CheckBox IsChecked="{Binding MonthlyDays[11]}"/>
                                    <Label Text="11" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="1" Grid.Column="4">
                                    <CheckBox IsChecked="{Binding MonthlyDays[12]}"/>
                                    <Label Text="12" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="1" Grid.Column="5">
                                    <CheckBox IsChecked="{Binding MonthlyDays[13]}"/>
                                    <Label Text="13" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="1" Grid.Column="6">
                                    <CheckBox IsChecked="{Binding MonthlyDays[14]}"/>
                                    <Label Text="14" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="2" Grid.Column="0">
                                    <CheckBox IsChecked="{Binding MonthlyDays[15]}"/>
                                    <Label Text="15" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="2" Grid.Column="1">
                                    <CheckBox IsChecked="{Binding MonthlyDays[16]}"/>
                                    <Label Text="16" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="2" Grid.Column="2">
                                    <CheckBox IsChecked="{Binding MonthlyDays[17]}"/>
                                    <Label Text="17" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="2" Grid.Column="3">
                                    <CheckBox IsChecked="{Binding MonthlyDays[18]}"/>
                                    <Label Text="18" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="2" Grid.Column="4">
                                    <CheckBox IsChecked="{Binding MonthlyDays[19]}"/>
                                    <Label Text="19" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="2" Grid.Column="5">
                                    <CheckBox IsChecked="{Binding MonthlyDays[20]}"/>
                                    <Label Text="20" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="2" Grid.Column="6">
                                    <CheckBox IsChecked="{Binding MonthlyDays[21]}"/>
                                    <Label Text="21" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="3" Grid.Column="0">
                                    <CheckBox IsChecked="{Binding MonthlyDays[22]}"/>
                                    <Label Text="22" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="3" Grid.Column="1">
                                    <CheckBox IsChecked="{Binding MonthlyDays[23]}"/>
                                    <Label Text="23" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="3" Grid.Column="2">
                                    <CheckBox IsChecked="{Binding MonthlyDays[24]}"/>
                                    <Label Text="24" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="3" Grid.Column="3">
                                    <CheckBox IsChecked="{Binding MonthlyDays[25]}"/>
                                    <Label Text="25" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="3" Grid.Column="4">
                                    <CheckBox IsChecked="{Binding MonthlyDays[26]}"/>
                                    <Label Text="26" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="3" Grid.Column="5">
                                    <CheckBox IsChecked="{Binding MonthlyDays[27]}"/>
                                    <Label Text="27" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="3" Grid.Column="6">
                                    <CheckBox IsChecked="{Binding MonthlyDays[28]}"/>
                                    <Label Text="28" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="4" Grid.Column="0">
                                    <CheckBox IsChecked="{Binding MonthlyDays[29]}"/>
                                    <Label Text="29" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="4" Grid.Column="1">
                                    <CheckBox IsChecked="{Binding MonthlyDays[30]}"/>
                                    <Label Text="30" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                                <HorizontalStackLayout Grid.Row="4" Grid.Column="2">
                                    <CheckBox IsChecked="{Binding MonthlyDays[31]}"/>
                                    <Label Text="31" VerticalTextAlignment="Center" TextColor="Black"/>
                                </HorizontalStackLayout>
                            </Grid>
                            <Label Text="Tip: Tap the days you want in the month."
                                FontSize="12" TextColor="#555" />
                        </VerticalStackLayout>

                        <!-- B) N-days per month -->
                        <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                            <Label Text="Days per month:" VerticalTextAlignment="Center" TextColor="Black" />
                            <Slider 
                                Minimum="1" Maximum="31"
                                Value="{Binding MonthlyDaysPerMonth}" WidthRequest="180"/>
                            <Label Text="{Binding MonthlyDaysPerMonth}" WidthRequest="32" HorizontalTextAlignment="Center" TextColor="Black" />
                        </HorizontalStackLayout>

                        <!-- Monthly validation hint -->
                        <Label Text="Select at least one: specific days or days per month."
                            TextColor="#B00020"
                            IsVisible="{Binding MonthlyInvalid}" />
                    </VerticalStackLayout>
                </Border>

                <!-- INTERVAL SECTION -->
                <Border 
                    Stroke="#7A8BB3" 
                    StrokeThickness="1" 
                    StrokeShape="RoundRectangle 12" 
                    Padding="12"
                    BackgroundColor="{StaticResource PrimaryBlue}">
                    <Border.Triggers>
                        <DataTrigger TargetType="Border" Binding="{Binding IsInterval}" Value="False">
                            <Setter Property="IsVisible" Value="False"/>
                        </DataTrigger>
                    </Border.Triggers>

                    <VerticalStackLayout Spacing="10">
                        <Label Text="Interval (Every N days)" FontAttributes="Bold" TextColor="Black" />
                        <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                            <Label Text="Every" VerticalTextAlignment="Center" TextColor="Black" />
                            <Entry WidthRequest="64"
                                Keyboard="Numeric"
                                Text="{Binding IntervalDays}"
                                HorizontalTextAlignment="Center" />
                            <Label Text="day(s)" VerticalTextAlignment="Center" TextColor="Black" />
                        </HorizontalStackLayout>

                        <!-- Interval required validation -->
                        <Label Text="Please enter a positive number of days."
                            TextColor="#B00020"
                            IsVisible="{Binding IntervalInvalid}" />
                    </VerticalStackLayout>
                </Border>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Footer -->
        <Grid 
            Grid.Row="2" 
            ColumnDefinitions="*,*" 
            Padding="16,8,16,8"
            BackgroundColor="{StaticResource PageFooter}">
            <Button
                Grid.Column="0"
                Text="Save"
                Style="{StaticResource FooterSave}"
                Command="{Binding SaveRegularityCommand}"
                Margin="0,0,8,0"/>
            <Button
                Grid.Column="1"
                Text="Cancel"
                Style="{StaticResource FooterCancel}"
                Command="{Binding CancelRegularityCommand}"
                Margin="8,0,0,0"/>
        </Grid>
    </Grid>
</ContentPage>